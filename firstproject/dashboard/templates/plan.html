{%extends 'basic.html'%}
{%load static%}
{%block content%}
<html>
<head>
   <meta charser='utf-8'>
   <meta name='viewport' content='width=device-width' initial-scale='1'>
   <meta http-equiv="content-type"content="text/html;charset=ISO-8859-1" />
   <title>Plan d'action</title>
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" rel="stylesheet">

   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>   
    
  
</head>
<body>
    <div class="col-sm-8"><h2>Plan d'action</h2></div>
    
    {%include 'calendrier.html'%}
    <div class="row">
        
        <div class="col-sm-8">  
            <button type="button" class="btn btn-success add-new" ><a href ="{%url 'ajouterPlan'%}" class="text-white shadow"> Ajouter un plan d'action </a></button>             
        </div>
            <br><br>
       
            <div class="search-box " >
                    <input onkeyup="searchData(this.value)" placeholder="Chercher..." type="text" id="search"  style="width: 250px; height:40px;"/><br>
                    <!--anything we put in search box it is passed in function parameter-->
                    <button onclick="getSearchMood(this.id)" id="chercherChapitre" class="btn btn-primary" style="width: 200px; height:35px; " >Chercher par chapitre</button>
                
                    <!-- id is passed in functiom parameter-->
                <br><br>
            
        </div>
    

    <div class="col-md-12">

        <table class="table align-middle mb-0 bg-white" >
          <thead class="bg-light">
        <tr>
            <th>Chapitre</th>
            <th>Actions </th>
            <th>Responsable(s) </th>
            <th>Date de d√©but</th>
            <th>Date de fin</th>
            <th>Budget</th>
            <th>Modifier</th>
            <th>Supprimer</th>
        </tr>
    </thead>
    <tbody id="table-body">
        {%for plan in plans%}
        <tr>
            <td>{{plan.chapitre}}</td>
            <td>{{plan.action}}</td>
            <td>{{plan.responsable}}</td>
            <td>{{plan.date_debut}}</td>
            <td>{{plan.date_fin}}</td>
            <td>{{plan.budget}}</td>
            <td><a class="btn btn-sm btn-success" href="{%url 'editPlan' plan.id%}">Modifier</a></td>
            <td><a class="btn btn-sm btn-danger" href="{%url 'supprimerPlan' plan.id%}">Supprimer</a></td>
         
        </tr>
        {%endfor%}
    </tbody>
    </table>

</div>
    
</div>
<script>
var searchMood='chapitre';
var planChapitreArray=[
{% for plan in plans%} 
{
    chapitre: "{{ plan.chapitre|safe }}",
    action: "{{ plan.action|safe }}",
    responsable: "{{ plan.responsable|safe }}",
    dateD: "{{ plan.date_debut|safe }}",
    dateF: "{{ plan.date_fin|safe }}",
    budget: "{{ plan.budget|safe }}"
},
    
{% endfor %}
];
//{}
function getSearchMood(id){
    var search = document.getElementById('search');
    if(id=='chercherChapitre'){
        searchMood='chapitre';
        search.placeholder='Chercher par Chapitre';
    }
    search.focus()

}

//fonctionnement du search
//{}
function searchData(value){
    var table='';
    
    if(searchMood =='chapitre'){   
        for(var i=0; i<planChapitreArray.length; i++){
            if(planChapitreArray[i].chapitre.toLowerCase().includes(value.toLowerCase())){
                 table+=
           `<tr>
            <td>${planChapitreArray[i].chapitre}</td>
            <td>${planChapitreArray[i].action}</td>
            <td>${planChapitreArray[i].responsable}</td>
            <td>${planChapitreArray[i].dateD}</td>
            <td>${planChapitreArray[i].dateF}</td>
            <td>${planChapitreArray[i].budget}</td>
            <td><a class="btn btn-sm btn-info" href="modifier">Modifier</a></td>
            <td><a class="btn btn-sm btn-danger" href="supprimer${planChapitreArray[i].id}">Supprimer</a></td>
            </tr>`;


            }
        }

    }
    
   //outside bcz we will use it in nom and entite
    document.getElementById('table-body').innerHTML=table;
    
}
</script>

</body>
</html> 
{%endblock%}
